<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IMPOSTOR ULTIMATE ONLINE</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background: #050508; color: #e2e8f0; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(15, 15, 25, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.1); border-radius: 2rem; }
        .neon-indigo { box-shadow: 0 0 20px rgba(79, 70, 229, 0.3); border: 1px solid rgba(99, 102, 241, 0.5); }
        .neon-red { box-shadow: 0 0 20px rgba(239, 68, 68, 0.3); border: 1px solid rgba(239, 68, 68, 0.5); }
        .accent-btn { background: linear-gradient(135deg, #6366f1 0%, #4338ca 100%); transition: 0.3s; }
        .accent-btn:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4); }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <div id="screen-menu" class="glass p-8 w-full max-w-md text-center shadow-2xl">
        <h1 class="text-5xl font-black mb-2 tracking-tighter text-transparent bg-clip-text bg-gradient-to-r from-indigo-400 to-purple-500">IMPOSTOR</h1>
        <p class="text-[10px] uppercase tracking-[0.4em] text-gray-500 mb-8">Multiplayer Edition</p>
        
        <div class="space-y-4">
            <input type="text" id="input-name" placeholder="Tvoje jm√©no" class="w-full bg-white/5 p-4 rounded-2xl border border-white/10 outline-none focus:border-indigo-500">
            <button onclick="createRoom()" class="w-full accent-btn py-4 rounded-2xl font-bold uppercase tracking-widest text-sm">Vytvo≈ôit novou m√≠stnost</button>
            <div class="flex items-center gap-4 py-2">
                <div class="h-[1px] bg-white/10 flex-grow"></div>
                <span class="text-xs text-gray-600 font-bold">NEBO</span>
                <div class="h-[1px] bg-white/10 flex-grow"></div>
            </div>
            <input type="text" id="input-room-id" placeholder="Vlo≈æ ID m√≠stnosti" class="w-full bg-white/5 p-4 rounded-2xl border border-white/10 outline-none">
            <button onclick="joinRoom()" class="w-full bg-white/5 hover:bg-white/10 py-4 rounded-2xl font-bold uppercase tracking-widest text-sm border border-white/10">P≈ôipojit se ke k√°mo≈°≈Øm</button>
        </div>
    </div>

    <div id="screen-lobby" class="glass p-8 w-full max-w-md hidden">
        <div class="text-center mb-6">
            <span class="text-[10px] text-gray-500 uppercase font-bold tracking-widest">ID tv√© m√≠stnosti:</span>
            <div id="display-room-id" class="text-xl font-mono font-bold text-indigo-400 mt-1 cursor-pointer" onclick="copyId()">---</div>
            <p class="text-[9px] text-gray-600 mt-1">(Klikni pro zkop√≠rov√°n√≠)</p>
        </div>

        <div class="space-y-6">
            <div class="bg-black/20 p-4 rounded-2xl border border-white/5">
                <h3 class="text-xs font-bold text-gray-500 uppercase mb-3 tracking-widest">Hr√°ƒçi v lobby:</h3>
                <ul id="list-players" class="space-y-2 font-medium text-indigo-100"></ul>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold mb-1 block">Kategorie</label>
                    <select id="select-category" class="w-full bg-white/5 p-3 rounded-xl border border-white/10 outline-none">
                        <option value="j√≠dlo">üçï J√≠dlo</option>
                        <option value="osobnosti">üåü Osobnosti</option>
                        <option value="≈°kola">üìö ≈†kola</option>
                        <option value="p≈ô√≠roda">üå≤ P≈ô√≠roda</option>
                        <option value="znaƒçky">üè∑Ô∏è Znaƒçky</option>
                        <option value="sport">‚öΩ Sport</option>
                        <option value="spicy">üå∂Ô∏è Spicy</option>
                    </select>
                </div>
                <div>
                    <label class="text-[10px] text-gray-500 uppercase font-bold mb-1 block">Imposto≈ôi</label>
                    <input type="number" id="input-imp-count" value="1" min="1" class="w-full bg-white/5 p-3 rounded-xl border border-white/10 outline-none">
                </div>
            </div>
            <button onclick="startServerGame()" class="w-full accent-btn py-4 rounded-2xl font-bold uppercase tracking-widest">Rozdat karty v≈°em</button>
        </div>
    </div>

    <div id="screen-game" class="glass p-8 w-full max-w-md hidden text-center">
        <div id="box-role" class="p-10 rounded-[2.5rem] mb-8 transition-all duration-700">
            <h3 id="txt-role-label" class="text-xs font-bold uppercase tracking-[0.3em] mb-6">---</h3>
            <p id="txt-main-word" class="text-5xl font-black tracking-tighter">---</p>
            <div class="h-[1px] bg-white/10 my-8"></div>
            <p id="txt-hint" class="text-sm font-medium opacity-60 px-4"></p>
        </div>
        <p class="text-xs text-gray-500 leading-relaxed">
            Teƒè se v≈°ichni d√≠vejte na sebe, ne na monitory.<br>
            Diskutujte a najdƒõte lh√°≈ôe.
        </p>
        <div id="host-reveal-controls" class="hidden mt-8">
            <button onclick="serverReveal()" class="w-full bg-red-600/20 hover:bg-red-600/40 text-red-500 border border-red-500/50 py-4 rounded-2xl font-bold uppercase tracking-widest text-xs">Ukonƒçit kolo a odhalit</button>
        </div>
    </div>

    <script>
        const db = {
            "j√≠dlo": [{s: "Sv√≠ƒçkov√°", h: "Tradiƒçn√≠ obƒõd"}, {s: "Sushi", h: "Mo≈ôsk√° ≈ôasa"}, {s: "Kebab", h: "Noƒçn√≠ hlad"}, {s: "Pizza", h: "Kulat√Ω it√°lie"}],
            "osobnosti": [{s: "Gott", h: "Zpƒõv√°k"}, {s: "J√°gr", h: "Hokejka"}, {s: "Babi≈°", h: "ƒåap√≠ hn√≠zdo"}, {s: "Elon Musk", h: "Rakety"}],
            "≈°kola": [{s: "Tabule", h: "K≈ô√≠da"}, {s: "Tah√°k", h: "Podvod"}, {s: "J√≠delna", h: "UHO om√°ƒçka"}, {s: "Tƒõlocvik", h: "Dres"}],
            "p≈ô√≠roda": [{s: "Dub", h: "≈Ωalud"}, {s: "Vlk", h: "Smeƒçka"}, {s: "H≈ôib", h: "Sma≈æenice"}, {s: "Blesk", h: "Bou≈ôka"}],
            "znaƒçky": [{s: "Nike", h: "Fajfka"}, {s: "Apple", h: "Ovoce"}, {s: "BMW", h: "Auto"}, {s: "Gucci", h: "Drahota"}],
            "sport": [{s: "Hokej", h: "Led"}, {s: "Tenis", h: "S√≠≈•"}, {s: "Fotbal", h: "Tr√°vn√≠k"}, {s: "Golf", h: "Jamka"}],
            "spicy": [{s: "Pouta", h: "Z√°pƒõst√≠"}, {s: "Postel", h: "Vrz√°n√≠"}, {s: "Biƒç√≠k", h: "BDSM"}, {s: "Vibr√°tor", h: "Baterky"}]
        };

        let peer, myName, isHost = false, myId, connections = [], players = [];
        let currentWord = "", currentImps = [];

        function createRoom() {
            myName = document.getElementById('input-name').value;
            if(!myName) return alert("Zadej jm√©no!");
            isHost = true;
            peer = new Peer();
            peer.on('open', id => {
                myId = id;
                document.getElementById('display-room-id').innerText = id;
                document.getElementById('screen-menu').classList.add('hidden');
                document.getElementById('screen-lobby').classList.remove('hidden');
                players.push({name: myName, id: peer.id});
                updateLobby();
            });
            peer.on('connection', conn => {
                conn.on('open', () => {
                    connections.push(conn);
                    conn.on('data', data => handleData(data, conn));
                });
            });
        }

        function joinRoom() {
            myName = document.getElementById('input-name').value;
            let roomId = document.getElementById('input-room-id').value;
            if(!myName || !roomId) return alert("Zadej jm√©no a ID!");
            peer = new Peer();
            peer.on('open', () => {
                let conn = peer.connect(roomId);
                conn.on('open', () => {
                    conn.send({type: 'JOIN', name: myName});
                    document.getElementById('screen-menu').innerHTML = "<div class='p-10 text-center animate-pulse text-indigo-400 font-bold uppercase tracking-widest'>ƒåek√°n√≠ na hostitele...</div>";
                });
                conn.on('data', data => handleData(data));
            });
        }

        function handleData(data, conn) {
            if(data.type === 'JOIN' && isHost) {
                players.push({name: data.name, conn: conn});
                updateLobby();
                broadcast({type: 'LIST', list: players.map(p => p.name)});
            }
            if(data.type === 'LIST') {
                // Klient m≈Ø≈æe vidƒõt seznam hr√°ƒç≈Ø (voliteln√©)
            }
            if(data.type === 'START') {
                showGameCard(data.role, data.word, data.hint);
            }
            if(data.type === 'REVEAL') {
                alert(`KONEC KOLA!\n\nImposto≈ôi byli: ${data.imps}\nSlovo bylo: ${data.word}`);
                location.reload();
            }
        }

        function updateLobby() {
            const list = document.getElementById('list-players');
            list.innerHTML = players.map(p => `<li class="flex items-center gap-2 bg-white/5 p-3 rounded-xl border border-white/5 animate-fade-in text-sm"><span class="w-2 h-2 rounded-full bg-green-500"></span> ${p.name}</li>`).join('');
        }

        function broadcast(data) {
            connections.forEach(c => c.send(data));
        }

        function startServerGame() {
            let cat = document.getElementById('select-category').value;
            let impCount = parseInt(document.getElementById('input-imp-count').value);
            if(players.length < 3) return alert("Pot≈ôebuje≈° aspo≈à 3 hr√°ƒçe!");
            
            let gameData = db[cat][Math.floor(Math.random() * db[cat].length)];
            currentWord = gameData.s;
            
            let shuffled = [...players].sort(() => Math.random() - 0.5);
            let imps = shuffled.slice(0, impCount).map(p => p.name);
            currentImps = imps;

            players.forEach(p => {
                let role = imps.includes(p.name) ? 'IMP' : 'CIV';
                let pData = {
                    type: 'START',
                    role: role,
                    word: role === 'IMP' ? '???' : gameData.s,
                    hint: gameData.h
                };
                if(p.name === myName) showGameCard(role, pData.word, pData.hint);
                else p.conn.send(pData);
            });

            document.getElementById('host-reveal-controls').classList.remove('hidden');
        }

        function showGameCard(role, word, hint) {
            document.getElementById('screen-menu').classList.add('hidden');
            document.getElementById('screen-lobby').classList.add('hidden');
            document.getElementById('screen-game').classList.remove('hidden');
            
            const box = document.getElementById('box-role');
            const label = document.getElementById('txt-role-label');
            const wordTxt = document.getElementById('txt-main-word');
            const hintTxt = document.getElementById('txt-hint');

            if(role === 'IMP') {
                box.className = "p-10 rounded-[2.5rem] mb-8 transition-all duration-700 glass neon-red";
                label.innerText = "JSI IMPOSTOR";
                label.classList.add('text-red-500');
                wordTxt.innerText = "???";
                hintTxt.innerText = "ASOCIACE: " + hint;
            } else {
                box.className = "p-10 rounded-[2.5rem] mb-8 transition-all duration-700 glass neon-indigo";
                label.innerText = "JSI CIVILISTA";
                label.classList.add('text-indigo-400');
                wordTxt.innerText = word;
                hintTxt.innerText = "Napov√≠dej opatrnƒõ pomoc√≠ asociaƒçn√≠ch slov.";
            }
        }

        function serverReveal() {
            broadcast({type: 'REVEAL', imps: currentImps.join(", "), word: currentWord});
            alert(`Odhaleno!\nImposto≈ôi: ${currentImps.join(", ")}\nSlovo: ${currentWord}`);
            location.reload();
        }

        function copyId() {
            navigator.clipboard.writeText(myId);
            alert("ID zkop√≠rov√°no!");
        }
    </script>
</body>
</html>
